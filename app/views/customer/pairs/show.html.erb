<div class="row">
  <div class="search-form col-sm-4 pull-right">
    <%= form_tag(search_path, method: :GET) do %>
    <div class="form-group col-sm-10 search-content">
      <%= text_field_tag 'search[content]', "", class: "form-control", placeholder: "タイトルで検索" %>
    </div>
    <div class="form-group-btn">
      <%= button_tag type: "submit", class: "btn btn-primary col-sm-2" do %>
      <i class="fas fa-search"></i>
      <% end %>
    </div>
    <% end %>
  </div>
</div>

<div class="row col-sm-offset-1 col-sm-10 col-sm-offset-1">
  <h2 class="heading text-center">投稿詳細</h2>

  <div class="col-sm-5">
    <%= attachment_image_tag @pair, :image, :fill, 350, 350, fallback: "no_image.jpg", size: "350x350", class: "pair-image"  %>
  </div>

  <div class="col-sm-7">
    <table class="table table-borderless">
      <tbody>
        <tr>
          <td>タイトル</td>
          <td><%= @pair.title %></td>
        </tr>
        <tr>
          <td>説明</td>
          <td><%= @pair.caption %></td>
        </tr>
        <tr>
          <td>タグ</td>
          <td>
            <% @pair.tags.each do |tag| %>
              <span class="label label-info"><%= link_to tag.name, tag_pairs_path(tag_id: tag.id) %></span>
            <% end %>
          </td>
        </tr>
        <tr>
          <td>投稿日</td>
          <td><%= @pair.created_at.strftime('%Y/%m/%d') %></td>
        </tr>
        <tr>
          <td>投稿者</td>
          <td><%= link_to @pair.customer.nickname, customer_path(@pair.customer) %></td>
        </tr>
        <tr>
          <td>お気に入り追加数</td>
          <td>
            <% if @pair.liked_by?(current_customer) %>
      <%= link_to pair_likes_path(@pair), method: :DELETE do %>
      <i class="fas fa-heart fa-lg red-heart"><span><%= @pair.likes.count %></span></i>
      <% end %>
      <% else %>
      <%= link_to pair_likes_path(@pair), method: :POST do %>
      <i class="far fa-heart fa-lg"><%= @pair.likes.count %></i>
      <% end %>
      <% end %>
          </td>
        </tr>
      </tbody>
    </table>
    <% if @pair.customer == current_customer %>
      <div class="text-center">
        <%= link_to "編集", edit_pair_path(@pair), class: "btn btn-success btn-block" %>
        <%= link_to "削除", pair_path(@pair), method: :DELETE, class: "btn btn-danger btn-block" %>
      </div>
    <% end %>
  </div>

  <div class="col-sm-12 comment-section">
    <div class="col-sm-3 label label-primary">
      <h3 class="comment-title">コメント<span class="badge comment-badge"><%= @pair.comments.count %></span></h3>
    </div>

    <div class="comment-form col-sm-9">
      <%= form_for [@pair, @comment] do |f| %>
        <%= f.text_area :text, size: "70x3", placeholder: "コメントを入力してください" %>
        <%= f.submit "送信", class: "btn-sm btn-primary" %>
      <% end %>
    </div>

    <div class="comment-index col-sm-12">
      <table>
        <% @comments.each do |comment| %>
        <tr>
          <td>
            <%= link_to customer_path(comment.customer) do %>
              <%= attachment_image_tag comment.customer, :profile_image, :fill, 40, 40, fallback: "no_customer_image.jpg", size: "40x40", class: "profile-image"  %><br>
              <%= comment.customer.nickname %>
            <% end %>
          </td>
          <td><%= comment.text %></td>
          <% if comment.customer == current_customer %>
          <td>
            <%= link_to "削除", pair_comment_path(@pair, comment), method: :DELETE, class: "btn btn-sm btn-danger" %>
          </td>
          <% end %>
        </tr>
        <% end %>
      </table>
    </div>

  </div>

</div>
